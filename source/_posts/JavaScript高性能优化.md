---
title: JavaScript高性能优化
date: 2017-12-28 08:42:56
tags: 性能优化
---

本文章列出了《高性能javascript》一书中的一些常用性能优化，并分为几大类归类总结一下。（持续更新....）


## 加载和执行

javascript代码执行过程会阻塞浏览器的其他进程，比如界面的绘制，每次遇到`<script>`标签，页面都必须停下来等待代码下载并执行,然后才继续处理其他部分，尽管如此，还是有几种办法能够减少对javascript对性能的影响。

> 1.`<body/>`标签闭合之前，将所有的`<script>`标签放到页面的底部，能够确保脚本执行前页面已经渲染

> 2.合并脚本，页面中`<script>`标签越少，加载速度也就越快。

> 3.有多种无阻塞下载javascript的方法
> - 使用`<script>`的defer属性
> - 使用动态的`<script>`元素来下载并执行代码
> - 使用XHR对象下来javascript代码并注入到页面


## 数据存储

在javascript中，数据存储的位置会对代码性能整体产生重大影响，数据存储分为4中方式，字面量、变量、数组项、对象成员。

> 1.访问字面量和局部变量的速度最快

> 2.由于局部变量存储在作用域链的起始位置（属性搜索机制），所有访问局部变量比访问跨域变量的速度更快，由于全局变量总处于作用域链的最末端，所以访问速度是最慢的。

> 3.循环嵌套对象成员会明显的影响性能（可能会导致引用计数无法回收干净），净量少用

> 4.属性或者方法在原型链中的位置越深，访问的速度也就越慢

> 5.通常，可以把常用的对象成员，数组元素，跨域变量保存在局部变量中来改善`javascript`的性能。


## DOM编程

访问DOM是Web应用的重要部分，但是每次穿越`ECMAScript`和`DOM`之间，都需要一定的性能，为了减少`DOM`编程带来的性能损失，总结为以下几点：

> 1.最小化`DOM`访问次数，尽可能在`javascript`端处理

> 2.如果需要多次访问`DOM`节点，请使用局部变量存储它的引用

> 3.小心处理`HTML`集合，因为他实时连接着底层文档，把集合长度缓存到一个变量中，并在迭代中使用他。

> 4.如果有可能的话，尽可能使用更快速的`API`

> 5.尽量减少重绘和重排的次数，批量修改样式时，“离线” 操作`DOM`树，使用缓存，并减少布局重排次数。

> 6.动画中使用绝对定位，使用拖放代理

> 7.使用事件委托来减少事件处理程序。

## 算法和流程控制

`javascript`和与他编程语言一样，代码的写法和算法会影响运行时间，与其他语言不同的是，`javascript`的运行资源有限。

> 1.`for`、`where`、`do-while`循环性能相当

> 2.避免使用`for-in`循环，除非是你需要遍历一个属性数量未知的对象

> 3.减少循环性能的最佳方式是减少迭代的运算量和减少循环迭代的次数

> 4.通常来说`switch`总是比`if-else`快

> 5.浏览器调用栈大小限制了递归算法，调用栈错误会导致其他程序终止运行（净量少用） IE调用栈与系统内存空闲有关，现代浏览器则跟调用栈大小有关。

## 字符串和正则表达式

> 1.当连接数量巨大或者尺寸巨大的字符串时，数组项合并是唯一在IE7及更早版本中性能合理的方法

> 2.如果不需要考虑IE7及更早版本的性能，数组项合并是最慢的字符串连接方法之一。推荐使用简单的+和+=操作符来替换，避免不必要的中间字符串。

> 3.正则部分（持续更新....）

## 快速响应的用户界面

`javascript`和用户界面在同一个进程中运行，因此一次只能处理一件事情。这意味着当`javascript`代码正在运行时，用户界面不能响应输入。反之也一样。

> 1.任何`javascript`任务都不应该执行超过100毫秒，过长的时间会导致`UI`更新出现明显的迟钝。

> 2.`javascript`长时间运行会导致用户体验出现混乱或者脱节。

> 3.定时器可用来安排代码延迟执行，它使得你可以把长时间运行的脚本分解成一系列的小人物（`setInterval`和`setTimeout`都是用于执行任务的，除了前者会不断向`UI`队列中添加任务，本质区别在于如果`UI`队列中已经存在`setInterval`创建的任务，那么后续任务不会被添加到`UI`队列中。）

> 4.`Web Worker`是新版浏览器的特性，它允许你在UI线程外部执行`javascript`代码，从而避免锁定UI

## 编程实践

> 1.通过避免使用`eval()`和`Function()`构造器来避免双重求值带来的性能消耗(每次都会创建一个解释器/编译器实例),同样的，给`setTimeout()`和`setInterval()`传递函数而不是字符串作为参数

> 2.尽量直接使用对象和数组字面量形式。

> 3.尽量保证使用原生方法，原生的方法比任何优化代码速度都要快。

## 构建并部署高性能应用

> 1.合并`javascript`文件减少`http`请求数

> 2.压缩`javascript`文件大小

> 3.在服务器端压缩`javascript`文件（`Gzip`）编码

> 4.设置`Http`响应头来缓存`javascript`文件，通过向文件名添加时间戳处理缓存

> 5.使用`CDN`(`CDN`不仅可以提升性能，它也为你管理文件的压缩和缓存)